"job_id","Role ID","Name","Enabled","Type","Command","Source File","trace_level","overlap","Schedule","start_delay","timer","Absolute Group"
"AUTO_CLOSE_LTL_ALLO","","Automatically Load and Close LTL Allo","1","cron","process dss ltl shipment auto load and close where ordtyp_list = 'A01,A02,APH' and wh_id = 'DC01'","$LESDIR/log/auto_close_ltl_allo.log","","0","0 0/10 0-1,20-23 * * ?","60","","usr_data"
"AUTO_CLOSE_LTL_ECOM","","Automatically Load and Close LTL eCom","0","cron","process dss ltl shipment auto load and close where ordtyp_list = 'E01,E03,G01,G03,R01,R03,B03,S01,S03,P01,P03,I01,I03' and wh_id = 'DC01'","$LESDIR/log/auto_close_ltl_ecom.log","","0","0 0/5 5-23 ? * * *","60","","usr_data"
"AUTO_CLOSE_LTL_RETAIL","","Automatically Load and Close LTL Retail","1","cron","process dss ltl shipment auto load and close where ordtyp_list = 'SR,MR,OT,SO,NFT,DCT,ECS,CUO,RTV,SC,ZRP' and wh_id = 'DC01'","$LESDIR/log/auto_close_ltl_retail.log","","0","0 0/10 0-1,10-14,19-23 * * ?","60","","usr_data"
"AUTO_CLOSE_LTL_US_ALLO","","Automatically Load and Close LTL US Allocation & Phone Checks","0","cron","process dss ltl shipment auto load and close where ordtyp_list = 'UNF' and wh_id = 'DC01'","$LESDIR/log/auto_close_ltl_us_allo.log","","0","0 0/10 5-6 * * ?","60","","usr_data"
"AUTO_CLOSE_LTL_US_RETAIL","","Automatically Load and Close LTL US Retail","0","cron","process dss ltl shipment auto load and close where ordtyp_list = 'USR,UNF,UUO,UOT' and wh_id = 'DC01'","$LESDIR/log/auto_close_ltl_us_retail.log","","0","0 0/10 10-13,17-20 * * ?","60","","usr_data"
"USR_AGED_CARTON","","Aritzia Aged Packed Cartons Report (Obsolete)","0","cron","expand environment variable
 where name = '\\aritzia-nt.local\public\Support\Logistics\13.0 Systems\DC01 Outputs\PROD\Aged Packed Cartons\Aged_Packed_Cartons' || '_' || to_char(sysdate, 'YYYYMMDDHH24MISS') || '.csv'
|
publish data
 where resfil = @name
|
[select distinct a.subnum,
        b.mstdte,
        a.subucc,
        a.stoloc,
        b.carcod,
        b.srvlvl,
        b.ordnum,
        b.ship_id,
        b.traknm
   from inventory_view a
   LEFT
   join manfst b
     on a.subnum = b.subnum
  where stoloc like 'STN%'
    and b.srvlvl <> 'RETURN'
  order by b.mstdte DESC] catch(-1403) >> res
|
if (@? = 0)
{
    write csv file
     where resdata = @res
       and filnam = @resfil
};
expand environment variable
 where name = '\\aritzia-nt.local\public\Support\Logistics\13.0 Systems\DC01 Outputs\PROD\Aged Packed Cartons\Aged_Packed_Cartons' || '_' || to_char(sysdate, 'YYYYMMDDHH24MISS') || '.csv'
|
publish data
 where resfil = @name
|
find file
 where pathname = @resfil catch(@?)
|
if (@pathname = @resfil and @type = 'F')
{
    publish data
     where hostname = 'arismtp.aritzia-nt.local'
       and mail_from = 'ITWMS-DC01Alerts@aritzia.com'
       and send_to_list = 'supplychaintechteam@aritzia.com'
    |
    send email
     where subject = 'Aged Packed Cartons'
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'The following Cartons are packed and are waiting to be moved to a Pallet'
       and attachment = @resfil
}","$LESDIR/log/usr_aged_carton","","0","0 15 5,12,23 ? * * *","60","","usr_data"
"USR_AGED_RETAIL_ALERT","","Aritzia Aged Retail Order Alert","0","cron","[select ship_id || ' , ' || schbat || ' , ' || early_shpdte || ' , ' || carcod || ' , ' || srvlvl || ' , ' || orddsc string
   from (select s.ship_id,
                sl.schbat,
                format(s.early_shpdte, 'MM-dd-yyyy') early_shpdte,
                s.carcod,
                s.srvlvl,
                pv.orddsc
           from shipment s
          inner
           join shipment_line sl
             on s.ship_id = sl.ship_id
          inner
           join ord o
             on sl.ordnum = o.ordnum
            and sl.client_id = o.client_id
            and sl.wh_id = o.wh_id
          inner
           join (select rtstr1 ordtyp,
                        rtstr2 orddsc
                   from poldat_view
                  where polcod = 'DSS-ARITZIA'
                    and polvar = 'REPORTING'
                    and polval = 'ORDTYP-XREF'
                    and rtstr2 not like '%ECOMM%'
                    and rtstr2 not like '%MARKETPLACE%'
                    and rtstr2 not like '%ORDER DELIVERY%'
                    and rtstr2 not like '%BULK%') pv
             on o.ordtyp = pv.ordtyp
          where s.carcod = 'ATLAS'
            and s.early_shpdte - (4 / 24) <= sysdate
            and s.shpsts not in ('B', 'C')
          group by s.ship_id,
                sl.schbat,
                s.early_shpdte,
                s.carcod,
                s.srvlvl,
                pv.orddsc
         union all
         select s.ship_id,
                sl.schbat,
                format(s.early_shpdte, 'MM-dd-yyyy') early_shpdte,
                s.carcod,
                s.srvlvl,
                pv.orddsc
           from shipment s
          inner
           join shipment_line sl
             on s.ship_id = sl.ship_id
          inner
           join ord o
             on sl.ordnum = o.ordnum
            and sl.client_id = o.client_id
            and sl.wh_id = o.wh_id
          inner
           join (select rtstr1 ordtyp,
                        rtstr2 orddsc
                   from poldat_view
                  where polcod = 'DSS-ARITZIA'
                    and polvar = 'REPORTING'
                    and polval = 'ORDTYP-XREF'
                    and rtstr2 not like '%ECOMM%'
                    and rtstr2 not like '%MARKETPLACE%'
                    and rtstr2 not like '%ORDER DELIVERY%'
                    and rtstr2 not like '%BULK%') pv
             on o.ordtyp = pv.ordtyp
          where s.carcod <> 'ATLAS'
            and s.early_shpdte <= dateadd(day, datediff(day, 0, sysdate), 0)
            and s.shpsts not in ('B', 'C')
          group by s.ship_id,
                sl.schbat,
                s.early_shpdte,
                s.carcod,
                s.srvlvl,
                pv.orddsc) usrdata
  order by early_shpdte] catch(-1403) >> res
|
if (@? = 0)
{
    convert column results to string
     where colnam = 'string'
       and res = @res
       and separator = '
	   
'
    |
    publish data
     where data = @result_string
       and hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'supplychaintechteam@aritzia.com;dcsupervisors@aritzia.com;dcteamleaders@aritzia.com;shipping@aritzia.com'
    |
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    send email
     where subject = 'Aged Retail Order Alert - Undispatced Orders Past Ship Date - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'SHIP ID , WAVE , SHIP DATE , CARRIER , SERVICE LEVEL , ORDER TYPE
' || '
' || @data
}","$LESDIR/log/usr_aged_retail.log","","0","5 0 19,20,21,22,23 ? * * *","60","","usr_data"
"USR_DISTRO_INVMOV_ALERT","","Aritzia Distro Inventory Move Issue Alert","0","cron","{
    [select distinct iv.subnum,
            'No DTL Invmov' prob
       from inventory_pckwrk_view iv
      inner
       join locmst loc
         on iv.stoloc = loc.stoloc
        and iv.wh_id = loc.wh_id
      inner
       join pckwrk_hdr pw
         on iv.wrkref = pw.wrkref
       left outer
       join invmov im
         on iv.dtlnum = im.lodnum
      where iv.stoloc in ('PNDPUTS-PROB', 'PNDPUTS-RCV-01', 'PNDPUTS-STG-01')
        and iv.ship_line_id is not null
        and pw.lodlvl = 'D'
        and im.stoloc is null
     union
     select distinct iv.subnum,
            'Sub Moves Exists' prob
       from inventory_pckwrk_view iv
      inner
       join locmst loc
         on iv.stoloc = loc.stoloc
        and iv.wh_id = loc.wh_id
      inner
       join pckwrk_hdr pw
         on iv.wrkref = pw.wrkref
       left outer
       join invmov im
         on iv.subnum = im.lodnum
      where iv.stoloc in ('PNDPUTS-PROB', 'PNDPUTS-RCV-01', 'PNDPUTS-STG-01')
        and iv.ship_line_id is not null
        and pw.lodlvl = 'D'
        and im.stoloc is not null
     union
     select distinct iv.subnum,
            'Load Moves Exists' prob
       from inventory_pckwrk_view iv
      inner
       join locmst loc
         on iv.stoloc = loc.stoloc
        and iv.wh_id = loc.wh_id
      inner
       join pckwrk_hdr pw
         on iv.wrkref = pw.wrkref
       left outer
       join invmov im
         on iv.lodnum = im.lodnum
      where iv.stoloc in ('PNDPUTS-PROB', 'PNDPUTS-RCV-01', 'PNDPUTS-STG-01')
        and iv.ship_line_id is not null
        and pw.lodlvl = 'D'
        and im.stoloc is not null] catch(-1403) >> res
    |
    if (@? = 0)
    {
        expand environment variable
         where name = '$dc01outputs' || '\Glitched Order\'
        |
        publish data
         where path = @value
        |
        write csv file
         where resdata = @res
           and filnam = 'distro_invmov_' || to_char(sysdate, 'YYYYMMDD-HH24') || '.csv'
           and path = @path
    }
};
expand environment variable
 where name = '$dc01outputs' || '\Glitched Order\distro_invmov_' || to_char(sysdate, 'YYYYMMDD-HH24') || '.csv'
|
publish data
 where resfil = @value
|
find file
 where pathname = @resfil catch(@?)
|
if (@pathname = @resfil and @type = 'F')
{
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'supplychaintechteam@aritzia.com;chkim@aritzia.com;chpark@aritzia.com;linlee@aritzia.com;mayoung@aritzia.com;skroes@aritzia.com;receiving@aritzia.com;mdelisimunovic@aritzia.com;CA_DCitemchecks@aritzia.com'
    |
    send email
     where subject = 'Distro Inventory Invmov Alert - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Attached cartons have problematic invmov entry issues. Please see attached.'
       and attachment = @resfil
}
","$LESDIR/log/usr_distro_invmov_alert.log
","","0","0 0 6-23 ? * 2-6 *","","","usr_data"
"USR_ER_ALERT","","Aritzia Duplicate ER Alert","0","cron","[select prtnum || '-' || count(*) str,
        count(*) prtcnt
   from pckwrk_hdr
  where wrktyp in ('E')
    and wh_id = 'DC01'
  group by prtnum
 having count(*) > 1] catch(-1403) >> res
|
if (@? = 0)
{
    convert column results to string
     where colnam = 'str'
       and res = @res
    |
    publish data
     where hostname = 'arismtp.aritzia-nt.local'
       and mail_from = 'ITWMS-DC01Alerts@aritzia.com'
       and send_to_list = 'jcwong@aritzia.com'
       and prtnum_l = @result_string
    |
    send email
     where subject = 'Duplicate ERs in Queue'
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Duplicate replenishments found for the following articles:
   
' || @prtnum_l catch(@?)
}","$LESDIR/log/usr_er_alert.log","","0","0 0/15 5-23 ? * 1-7 *","60","","usr_data"
"USR_ER_ESCALATION","","Aritzia ER Escalation","0","cron","list warehouses
|
[select DATEADD(d, -1, DATEDIFF(d, 0, sysdate)) + (0.0 / 24) dte1,
        0 srchpak
   from dual]
|
[select *
   from (select jde.job_id,
                jde.node_url,
                jde.start_dte,
                jde.status,
                jde.message,
                jde.end_dte,
                row_number() over(partition by jde.job_id
                                   order by jde.end_dte desc) as row_number
           from job_definition_exec jde
          where jde.job_id = 'USR_REPLENMGR'
            and jde.start_dte > to_date(@dte1)
            and jde.end_dte is not null) usr
  where usr.row_number = '2']
|
[/* ER allocation */
 select rplref
   from rplwrk rw
  inner
   join (select distinct d.prtnum
           from dlytrn d
          inner
           join (select subnum
                   from dlytrn
                  inner
                   join (select *
                           from poldat
                          where polcod = 'DSS-ARITZIA'
                            and polvar = 'CASEPICK'
                            and rtstr1 like 'ATZ_ER%') rep
                     on oprcod = rep.rtstr1
                  where fr_arecod in ('RESV', 'ELRV')
                    and trndte > to_date(@dte1)) pck
             on d.subnum = pck.subnum
          where d.to_arecod = 'PICK'
            and d.fr_arecod = 'RDTS000001'
            and d.trndte > to_date(@usr.end_dte)) rpl
     on rpl.prtnum = rw.prtnum
  where schbat is not null]
|
|
list policies
 where polcod = 'EMERGENCY-REPLENISHMENTS'
   and polvar = 'INSTALLED'
   and polval = 'INSTALLED'
   and wh_id = @wh_id catch(-1403)
|
{
    complete emergency replenishment
     where rplref = @rplref
       and wh_id = @wh_id
       and comflg = 1 catch(@?)
    |
    commit
    |
    allocate emergency replenishment
     where rplref = @rplref
       and wh_id = @wh_id
       and comflg = 1 catch(@?)
    |
    commit
    |
    process emergency replenishment expiration
     where rplref = @rplref
       and wh_id = @wh_id
       and comflg = 1 catch(@?)
    |
    commit
    |
    process emergency replenishment errors
     where rplref = @rplref
       and wh_id = @wh_id
       and comflg = 1 catch(@?)
    |
    commit
}
","$LESDIR/log/usr_er_esclation.log
","","0","0 0,30 * 23,24,25,26,27,28,29,30 NOV ? 2022","60","","usr_data"
"USR_FDX_ALERT","","Aritzia Fedex Manifest Alert MON-FRI","0","cron","[select distinct mancls
   from manfst m
  inner
   join carxrf cx
     on m.carcod = cx.carcod
    and m.srvlvl = cx.srvlvl
  where m.mansts = 'R'
    and cx.dstcar = '17'
    and to_char(shpdte, 'MM-DD-YYYY') = to_char(sysdate, 'MM-DD-YYYY')] catch(-1403) >> res
|
if (@? = 0)
{
    convert column results to string
     where resultset = @res
       and colnam = 'mancls'
       and separator = ','
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'dcsupervisors@aritzia.com;shipping@aritzia.com;supplychaintechteam@aritzia.com'
       and mancls = @result_string
    |
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    send email
     where subject = 'Fedex Manifest Not Closed: ' || @mancls || ' - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Fedex Manifest Left Open
   
Please close Fedex manifest(s) ' || @mancls || ' before 11:30PM PST.
   
This alert is active from 9:30PM PST to 10:00PM PST and will execute every 5 minutes during this window.' catch(@?)
}","$LESDIR/log/usr_fdx_alert.log","","0","0 30,35,40,45,50,55 21 ? * 2-6 *","60","","usr_data"
"USR_FDX_ALERT2","","Aritzia Parcel Manifest Alert MON-FRI (2)","0","cron","[select distinct mancls
   from manfst m
  inner
   join carxrf cx
     on m.carcod = cx.carcod
    and m.srvlvl = cx.srvlvl
  where m.mansts = 'R'
    and cx.dstcar = '17'
    and to_char(shpdte, 'MM-DD-YYYY') = to_char(sysdate, 'MM-DD-YYYY')] catch(-1403) >> res
|
if (@? = 0)
{
    convert column results to string
     where resultset = @res
       and colnam = 'mancls'
       and separator = ','
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'dcsupervisors@aritzia.com;shipping@aritzia.com;supplychaintechteam@aritzia.com'
       and mancls = @result_string
    |
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    send email
     where subject = 'Fedex Manifest Not Closed: ' || @mancls || ' - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Fedex Manifest Left Open
   
Please close Fedex manifest(s) ' || @mancls || ' before 11:30PM PST.
   
This alert is active from 9:30PM PST to 10:00PM PST and will execute every 5 minutes during this window.' catch(@?)
}","$LESDIR/log/usr_fdx_alert.log","","0","0 0 22 ? * 2-6 *","60","","usr_data"
"USR_FDX_ALERT3","","Aritzia Parcel Manifest Alert SAT","0","cron","[select distinct mancls
   from manfst m
  inner
   join carxrf cx
     on m.carcod = cx.carcod
    and m.srvlvl = cx.srvlvl
  where m.mansts = 'R'
    and cx.dstcar = '17'
    and to_char(shpdte, 'MM-DD-YYYY') = to_char(sysdate, 'MM-DD-YYYY')] catch(-1403) >> res
|
if (@? = 0)
{
    convert column results to string
     where resultset = @res
       and colnam = 'mancls'
       and separator = ','
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'dcsupervisors@aritzia.com;shipping@aritzia.com;supplychaintechteam@aritzia.com'
       and mancls = @result_string
    |
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    send email
     where subject = 'Fedex Manifest Not Closed: ' || @mancls || ' - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Fedex Manifest Left Open
   
Please close Fedex manifest(s) ' || @mancls || ' before 11:30PM PST.
   
This alert is active from 7:30PM PST to 8:00PM PST and will execute every 15 minutes during this window.' catch(@?)
}","$LESDIR/log/usr_fdx_alert.log","","0","0 0,15,30 13 ? * 7 *","60","","usr_data"
"USR_FDX_ALERT4","","Aritzia Parcel Manifest Alert SUN","0","cron","[select distinct mancls
   from manfst m
  inner
   join carxrf cx
     on m.carcod = cx.carcod
    and m.srvlvl = cx.srvlvl
  where m.mansts = 'R'
    and cx.dstcar = '17'
    and to_char(shpdte, 'MM-DD-YYYY') = to_char(sysdate, 'MM-DD-YYYY')] catch(-1403) >> res
|
if (@? = 0)
{
    convert column results to string
     where resultset = @res
       and colnam = 'mancls'
       and separator = ','
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'dcsupervisors@aritzia.com;shipping@aritzia.com;supplychaintechteam@aritzia.com'
       and mancls = @result_string
    |
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    send email
     where subject = 'Fedex Manifest Not Closed: ' || @mancls || ' - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Fedex Manifest Left Open
   
Please close Fedex manifest(s) ' || @mancls || ' before 11:30PM PST.
   
This alert is active from 7:30PM PST to 8:00PM PST and will execute every 15 minutes during this window.' catch(@?)
}","$LESDIR/log/usr_fdx_alert.log","","0","0 30,45,59 19 ? * 1 *","60","","usr_data"
"USR_FSMSTEST","","Aritzia FSMS Manifest Test (Temp)","0","cron","list warehouses
|
[select @wh_id];
{
    list warehouses
    |
    process dss auto manifest carton on packout
     where ctnnum = 'SHP00005LPBI'
       and devcod = 'SOBCLP0939'
       and wh_id = @wh_id
       and weight = '60' catch(@?)
};
{
    [select mfsmsn
       from manfst
      where subnum = 'SHP00005LPBI'] catch(@?)
    |
    if (@? = 0)
    {
        list warehouses
        |
        remove pm package
         where mfsmsn = @mfsmsn
           and wh_id = @wh_id
    }
};
{
    list warehouses
    |
    process dss auto manifest carton on packout
     where ctnnum = 'SHP00005LPO7'
       and devcod = 'SOBCLP0939'
       and wh_id = @wh_id
       and weight = '60' catch(@?)
};
{
    [select mfsmsn
       from manfst
      where subnum = 'SHP00005LPO7'] catch(@?)
    |
    if (@? = 0)
    {
        list warehouses
        |
        remove pm package
         where mfsmsn = @mfsmsn
           and wh_id = @wh_id
    }
};
","","","0","5 0/1 23,0-6 ? * * *","","",""
"USR_GLITCH_ORD_ALERT","","Aritzia Glitched Order Alert","0","cron","{
    [select s.ship_id
       from inventory_view iv
      inner
       join shipment_line sl
         on iv.ship_line_id = sl.ship_line_id
      inner
       join shipment s
         on sl.ship_id = s.ship_id
      where iv.stoloc like 'STGSHIP%'
        and s.shpsts <> 'S'
      group by s.ship_id] catch(@?)
    |
    if (@? = 0)
    {
        /* no unstaged inventory */
        [select distinct 'x'
           from shipment_line sl
          inner
           join inventory_view iv
             on sl.ship_line_id = iv.ship_line_id
          where sl.ship_id = @ship_id
            and iv.stoloc not like 'STGSHIP%'] catch(@?)
        |
        if (@? = -1403)
        {
            /* no outstanding replen */
            [select distinct 'x'
               from rplwrk
              where ship_id = @ship_id] catch(@?)
            |
            if (@? = -1403)
            {
                /* no outstanding picks */
                [select distinct 'x'
                   from pckwrk_view pw
                  where wrktyp in ('P', 'B')
                    and ship_id = @ship_id
                    and appqty < pckqty] catch(@?)
                |
                if (@? = -1403)
                {
                    check ok to stage shipment
                     where ship_id = @ship_id catch(@?)
                    |
                    if (@? = 0)
                    {
                        write output file
                         where filnam = 'usr_glitch_ord_list.log'
                           and data = sysdate || ',' || @ship_id || ',' || 'Attempting to stage shipment.'
                           and newline = 'Y'
                           and mode = 'A'
                           and path = '$LESDIR/log'
                        |
                        register shipment staged
                         where ship_id = @ship_id
                           and rstg_flg = @rstg_flg
                    }
                    else
                    {
                        publish data
                         where ship_id = @ship_id >> res
                        |
                        expand environment variable
                         where name = '$dc01outputs' || '\Glitched Order\'
                        |
                        publish data
                         where path = @value
                        |
                        write csv file
                         where resdata = @res
                           and filnam = 'Gltiched_order' || to_char(sysdate, 'YYYYMMDD-HH24') || '.csv'
                           and path = @path
                    }
                }
            }
        }
    }
};
expand environment variable
 where name = '$dc01outputs' || '\Glitched Order\Gltiched_order' || to_char(sysdate, 'YYYYMMDD-HH24') || '.csv'
|
publish data
 where resfil = @value
|
find file
 where pathname = @resfil catch(@?)
|
if (@pathname = @resfil and @type = 'F')
{
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'supplychaintechteam@aritzia.com'
    |
    send email
     where subject = 'Glitched Order Alert - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Attached orders were staged but are glitched. Please see attached.'
       and attachment = @resfil
}","$LESDIR/log/usr_glitch_ord.log","","0","0 5 6-23/2 ? * 1-7 *","60","","usr_data"
"USR_INBSHP_PRTFTP","","Aritzia Inbound Receiving Report","0","cron","[select rt.trknum,
        ri.invnum,
        ri.invtyp,
        ri.po_num,
        rl.prtnum,
        pd.lngdsc,
        psd.prtsize_dsc,
        pm.prtfam,
        dpm.merch_catg,
        dpm.generic generic,
        pcd.prtcolor_dsc,
        sum(rl.expqty) expqty,
        sum(rl.idnqty) idnqty,
        sum(rl.rcvqty) rcvqty,
        pf.ftpcod,
        round(pfd.len, 3) cs_l,
        round(pfd.wid, 3) cs_w,
        round(pfd.hgt, 3) cs_h,
        round(pfd.len*pfd.wid*pfd.hgt, 2) cs_vol,
        pfd.untqty cs_qty
   from rcvtrk rt
  inner
   join rcvinv ri
     on ri.trknum = rt.trknum
  inner
   join rcvlin rl
     on ri.invnum = rl.invnum
  inner
   join prtmst pm
     on rl.prtnum = pm.prtnum
    and rl.wh_id = pm.wh_id_tmpl
    and rl.prt_client_id = pm.prt_client_id
  inner
   join dss_prtmst dpm
     on rl.prtnum = dpm.prtnum
    and rl.wh_id = dpm.wh_id
    and rl.prt_client_id = dpm.prt_client_id
  inner
   join prtdsc pd
     on pd.colnam = 'prtnum|prt_client_id|wh_id_tmpl'
    and pd.colval = /*=varchar(*/ nvl(pm.prtnum, rtrim(' ')) || '|' || nvl(pm.prt_client_id, rtrim(' ')) || '|' || nvl(pm.wh_id_tmpl, rtrim(' ')) /*=)*/
  inner
   join (select colval prtcolor,
                lngdsc prtcolor_dsc
           from dscmst
          where colnam = 'prtcolor'
            and locale_id = 'US_ENGLISH') pcd
     on pm.prtcolor = pcd.prtcolor
  inner
   join (select colval prtsize,
                lngdsc prtsize_dsc
           from dscmst
          where colnam = 'prtsize'
            and locale_id = 'US_ENGLISH') psd
     on pm.prtsize = psd.prtsize
   left outer
   join prtftp pf
     on rl.prtnum = pf.prtnum
    and rl.wh_id = pf.wh_id
    and pf.defftp_flg = 1
   left outer
   join prtftp_dtl pfd
     on pf.prtnum = pfd.prtnum
    and pf.ftpcod = pfd.ftpcod
    and pf.wh_id = pfd.wh_id
    and pfd.uomcod = 'CS'
  where rt.clsdte is null
    and ri.invtyp not in ('MP', 'QM', 'SR', 'ZERE', 'SUP')
  group by rt.trknum,
        ri.invnum,
        ri.invtyp,
        ri.po_num,
        rl.prtnum,
        pd.lngdsc,
        psd.prtsize_dsc,
        pm.prtfam,
        dpm.merch_catg,
        dpm.generic,
        pcd.prtcolor_dsc,
        substr(rl.prtnum, 1, 5),
        pf.ftpcod,
        round(pfd.len, 3),
        round(pfd.wid, 3),
        round(pfd.hgt, 3),
        round(pfd.len*pfd.wid*pfd.hgt, 2),
        pfd.untqty
  order by rt.trknum,
        ri.invnum,
        rl.prtnum] catch(-1403) >> res
|
if (@? = 0)
{
    expand environment variable
     where name = '$dc01outputs' || '\Inbound Report\'
    |
    publish data
     where path = @value
    |
    write csv file
     where resdata = @res
       and filnam = 'trknum_prtftp-' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
       and path = @path
}","$LESDIR/log/usr_inbshp_prtftp.log","","0","0 0 5 * * ?","60","","usr_data"
"USR_INT_ALERT_ERROR_IFDS","","Aritzia Alert of Error IFDs in Outbound Integration","0","cron","/*This query will get the count of stuck messages with the below statuses and a timestamp older than 5 minutes ago.*/
[select count(evt_data_seq) record_count
   from sl_evt_data
  where evt_stat_cd in ('SE', 'IE', 'IC', 'EE')
    and sys_id = 'DCS'
    and evt_dt < dateadd(minute, -5, sysdate)] catch(-1403)
|
if (@record_count > 0)
{
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    get server information
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to = 'ITWMS-DC01Alerts@aritzia.com;jcwong@aritzia.com'
       and sys_url = @url
    |
    send email
     where subject = @envdsc || ' Integration Alert: ' || @record_count || ' Messages in Error (' || @sys_url || ')'
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to
       and message = 'There are ' || @record_count || ' message(s) found in the JDA Event Query.  
The Event Statuses to search for are SE, IE, IC, and EE for the Triggering System DCS (this represents outbound messages).

Alert issued from instance: ' || @sys_url || '

This alert was generated from Job USR_INT_ALERT_ERROR_IFDS and will trigger every 5 minutes until there are no further stuck messages.'
}","","","0","0 3/10 * * * ?","0","","les_data"
"USR_INT_MISSING_IFDS","","Aritzia Integration Downloads Missing IFDs","0","timer","[select dwnld_seq
   from sl_dwnld
  where ins_dt > (sysdate - 0.5 / 24)
 except
 select dwnld_seq
   from sl_ifd_data_hdr
  where ins_dt > (sysdate - 0.5 / 24)] catch(@?) >> res1
|
if (@? = 0)
{
    [[String listOut = '';
      while(res1.next())
      {
          if (listOut == '')
          {
            listOut = res1.getString('dwnld_seq');
          }
          else
          {
            listOut = listOut + ', ' + res1.getString('dwnld_seq');
          }
      }
      return listOut;]]
    |
    expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
	get server information
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to = 'jhutchinson@aritzia.com'
       and sys_url = @url
    |
    send email
     where subject = @envdsc || ' Integration Alert: Downloads with no IFD (' || @sys_url || ')'
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to
       and message = 'These download sequences are missing IFDs:
' || @result || '

View the download details using Download Viewer.  The file will need to be redropped into the inbound directory ie. UC_SAP_IN_P*
 
Alert issued from instance: ' || @sys_url || '

This alert was generated from Job USR_INT_MISSING_IFDS and runs every 30 minutes.'
}","","","0","","60","1800","les_data"
"USR_INV_LOC","","Aritzia Inventory by Location Report","0","cron","[select ceil(convert(decimal, count(*)) / 100000) cnt
   from locmst loc
  inner
   join loc_typ lt
     on loc.loc_typ_id = lt.loc_typ_id
   left outer
   join (select iv.stoloc,
                iv.prtnum article,
                iv.invsts,
                count(distinct iv.subnum) cascnt,
                sum(iv.untqty) untqty
           from inventory_view iv
          inner
           join locmst loc
             on iv.stoloc = loc.stoloc
          inner
           join loc_typ lt
             on loc.loc_typ_id = lt.loc_typ_id
          where iv.ship_line_id is null
            and loc.useflg = 1
            and lt.sigflg = 1
            and loc.wh_id = nvl(@wh_id, 'DC01')
            and iv.invsts not in ('WHS', 'DON')
          group by iv.prtnum,
                iv.stoloc,
                iv.invsts) invlst
     on invlst.stoloc = loc.stoloc
  where loc.useflg = 1
    and lt.sigflg = 1
    and loc.wh_id = nvl(@wh_id, 'DC01')]
|
do loop
 where count = @cnt
|
{
    publish data
     where offset = @i * 100000
    |
    [/*#limit=@offset,@limit,true*/
     select loc.arecod area,
            loc.stoloc,
            loc.wrk_zone_id,
            loc.locacc,
            loc.curqvl,
            loc.maxqvl,
            nvl(invlst.article, '-') article,
            nvl(invlst.invsts, '-') invsts,
            nvl(invlst.untqty, 0) untqty,
            nvl(invlst.cascnt, 0) cascnt,
            nvl(invlst.merch_catg, '-') merch_catg
       from locmst loc
      inner
       join loc_typ lt
         on loc.loc_typ_id = lt.loc_typ_id
       left outer
       join (select iv.stoloc,
                    iv.prtnum article,
                    iv.invsts,
                    dpm.merch_catg,
                    count(distinct iv.subnum) cascnt,
                    sum(iv.untqty) untqty
               from inventory_view iv
              inner
               join locmst loc
                 on iv.stoloc = loc.stoloc
              inner
               join loc_typ lt
                 on loc.loc_typ_id = lt.loc_typ_id
              inner
               join dss_prtmst dpm
                 on iv.prtnum = dpm.prtnum
                and iv.prt_client_id = dpm.prt_client_id
                and iv.wh_id = dpm.wh_id
              where iv.ship_line_id is null
                and loc.useflg = 1
                and lt.sigflg = 1
                and loc.wh_id = nvl(@wh_id, 'DC01')
                and iv.invsts not in ('WHS', 'DON')
              group by iv.prtnum,
                    iv.stoloc,
                    iv.invsts,
                    dpm.merch_catg) invlst
         on invlst.stoloc = loc.stoloc
      inner
       join aremst am
         on loc.arecod = am.arecod
        and loc.wh_id = am.wh_id
      where loc.useflg = 1
        and lt.sigflg = 1
        and loc.wh_id = nvl(@wh_id, 'DC01')
      order by loc.stoloc,
            loc.locacc,
            loc.curqvl,
            loc.maxqvl] >> res
    |
    expand environment variable
     where name = '$dc01outputs' || '\Inventory Snapshot\'
    |
    publish data
     where path = @value
    |
    write csv file
     where resdata = @res
       and filnam = 'inv_location_' || to_char(@i + 1) || '_' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
       and path = @path
}","$LESDIR/log/usr_inv_loc.log","","0","0 15 4,14 * * ?","60","","usr_data"
"USR_INV_MULTIPF","","Aritzia Multi Pick Face Report","0","cron","[select iv.prtnum,
        iv.untqty,
        usr.loccnt,
        usr.totunt,
        loc.aisle_id,
        loc.stoloc,
        loc.curqvl,
        loc.maxqvl,
        sz.sto_zone_cod,
        pz.pcK_zone_cod,
        mz.mov_zone_cod,
        zm.wrkzon,
        max(loc.maxqvl) over(partition by iv.prtnum) glbmax,
        sum(loc.curqvl) over(partition by iv.prtnum) glbcur,
        max(loc.maxqvl) over(partition by iv.prtnum) - sum(loc.curqvl) over(partition by iv.prtnum) glbrem
   from (select prtnum,
                stoloc,
                count(distinct subnum) cscnt,
                sum(untqty) untqty
           from inventory_view
          where invsts in ('AVL', 'HLD', 'VAS', 'DNA')
          group by prtnum,
                stoloc) iv
  inner
   join (select iv.prtnum,
                count(distinct loc.stoloc) loccnt,
                sum(iv.untqty) totunt
           from inventory_view iv
          inner
           join locmst loc
             on iv.stoloc = loc.stoloc
          inner
           join loc_typ lt
             on loc.loc_typ_id = lt.loc_typ_id
          where lt.fwiflg = 1
            and loc.arecod = 'PICK'
            and loc.pckflg = 1
            and lt.sigflg = 1
          group by iv.prtnum
         having count(distinct (loc.stoloc)) > 1) usr
     on iv.prtnum = usr.prtnum
  inner
   join locmst loc
     on iv.stoloc = loc.stoloc
  inner
   join loc_typ lt
     on loc.loc_typ_id = lt.loc_typ_id
  inner
   join sto_zone sz
     on loc.sto_zone_id = sz.sto_zone_id
  inner
   join mov_zone mz
     on loc.mov_zone_id = mz.mov_zone_id
  inner
   join zonmst zm
     on loc.wrk_zone_id = zm.wrk_zone_id
  inner
   join pck_zone pz
     on loc.pck_zone_id = pz.pck_zone_id
  where lt.fwiflg = 1
    and loc.arecod = 'PICK'
    and loc.pckflg = 1
    and lt.sigflg = 1
  order by usr.loccnt desc,
        iv.prtnum,
        loc.stoloc] catch(-1403) >> res
|
if (@? = 0)
{
    expand environment variable
     where name = '$dc01outputs' || '\Inventory Snapshot\'
    |
    publish data
     where path = @value
    |
    write csv file
     where resdata = @res
       and filnam = 'multipf_sku-' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
       and path = @path
}","$LESDIR/log/usr_inv_multipf.log","","0","0 45 3 * * ?","60","","usr_data"
"USR_INV_MULTIRS","","Aritzia Multi Reserve Report","0","cron","[select iv.prtnum,
        iv.untqty,
        iv.cscnt,
        iv.ftpcod,
        usr.loccnt,
        usr.totunt,
        loc.aisle_id,
        loc.stoloc,
        loc.curqvl,
        loc.maxqvl,
        sz.sto_zone_cod,
        pz.pcK_zone_cod,
        mz.mov_zone_cod,
        zm.wrkzon,
        max(loc.maxqvl) over(partition by iv.prtnum, iv.ftpcod) glbmax,
        sum(loc.curqvl) over(partition by iv.prtnum, iv.ftpcod)  glbcur,
        max(loc.maxqvl) over(partition by iv.prtnum, iv.ftpcod) - sum(loc.curqvl) over(partition by iv.prtnum, iv.ftpcod) glbrem
   from (select prtnum,
                ftpcod,
                stoloc,
				count(distinct subnum) cscnt,
                sum(untqty) untqty
           from inventory_view
		   where invsts in ('AVL', 'HLD', 'VAS', 'DNA')
          group by prtnum,
                ftpcod,
                stoloc) iv
  inner
   join (select iv.prtnum,
                iv.ftpcod,
                count(distinct loc.stoloc) loccnt,
                sum(iv.untqty) totunt
           from inventory_view iv
          inner
           join locmst loc
             on iv.stoloc = loc.stoloc
          inner
           join loc_typ lt
             on loc.loc_typ_id = lt.loc_typ_id
          where lt.fwiflg = 1
            and loc.arecod = 'RESV'
            and lt.sigflg = 1
            and iv.invsts in ('AVL', 'HLD', 'VAS', 'DNA')
          group by iv.prtnum,
                iv.ftpcod
         having count(distinct (loc.stoloc)) > 1) usr
     on iv.prtnum = usr.prtnum
    and iv.ftpcod = usr.ftpcod
  inner
   join locmst loc
     on iv.stoloc = loc.stoloc
  inner
   join loc_typ lt
     on loc.loc_typ_id = lt.loc_typ_id
  inner
   join sto_zone sz
     on loc.sto_zone_id = sz.sto_zone_id
  inner
   join mov_zone mz
     on loc.mov_zone_id = mz.mov_zone_id
  inner
   join zonmst zm
     on loc.wrk_zone_id = zm.wrk_zone_id
  inner
   join pck_zone pz
     on loc.pck_zone_id = pz.pck_zone_id
  where lt.fwiflg = 1
    and loc.arecod = 'RESV'
    and lt.sigflg = 1
   order by glbrem desc,
        usr.loccnt desc,
        iv.prtnum,
        loc.stoloc] >> res
|
if (@? = 0)
{
    expand environment variable
     where name = '$dc01outputs' || '\Inventory Snapshot\'
    |
    publish data
     where path = @value
	 |
    write csv file
     where resdata = @res
       and filnam = 'multirs_sku-' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
	   and path = @path
}","$LESDIR/log/usr_inv_multirs.log","","0","0 50 3 * * ?","60","","usr_data"
"USR_INV_PACKSTG","","Aritzia Packed Carton Age Report","0","cron","{
    [select iv.stoloc,
            iv.subnum,
            iv.subucc,
            sl.ordnum,
            s.ship_id,
            s.carcod,
            s.srvlvl,
            s.early_shpdte,
            m.traknm traknm,
            max(m.mstdte) mstdte,
            max(iv.lstmov) lstmov,
            sum(iv.untqty) untqty
       from inventory_view iv
      inner
       join locmst loc
         on iv.stoloc = loc.stoloc
        and iv.wh_id = loc.wh_id
      inner
       join shipment_line sl
         on iv.ship_line_id = sl.ship_line_id
      inner
       join shipment s
         on sl.ship_id = s.ship_id
      inner
       join manfst m
         on iv.subnum = m.subnum
        and m.srvlvl <> 'RETURN'
      where loc.arecod = 'PACK'
        and loc.stoloc like '%STG'
      group by iv.stoloc,
            iv.subnum,
            iv.subucc,
            sl.ordnum,
            s.ship_id,
            s.carcod,
            s.srvlvl,
            s.early_shpdte,
            m.traknm
      order by lstmov] catch(@?) >> res
    |
    if (@? = 0)
    {
        expand environment variable
         where name = '$dc01outputs' || '\Aged Packed Cartons\'
        |
        publish data
         where path = @value
        |
        write csv file
         where resdata = @res
           and filnam = 'PACKSTG_' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
           and path = @path
    }
};
{
    [select dly.to_lodnum,
            max(dly.trndte) lstmov
       from dlytrn dly
      inner
       join (select distinct lodnum
               from inventory_view
              where stoloc = 'PNDSHIP-01') lod
         on dly.to_lodnum = lod.lodnum
      group by dly.to_lodnum
      order by 2,
            1] catch(@?) >> res
    |
    if (@? = 0)
    {
        expand environment variable
         where name = '$dc01outputs' || '\Aged Packed Cartons\'
        |
        publish data
         where path = @value
        |
        write csv file
         where resdata = @res
           and filnam = 'PNDSHIP_' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
           and path = @path
    }
};
{
    [select iv.stoloc,
            iv.lodnum,
            iv.subnum cur_subnum,
            iv.subucc cur_subucc,
            iv.dtlnum,
            pw.ordnum,
            pw.ship_ctnnum true_subnum,
            pw2.subucc true_subucc
       from inventory_view iv
      inner
       join pckwrk_view pw
         on iv.wrkref_dtl = pw.wrkref_dtl
      inner
       join pckwrk_view pw2
         on pw.ship_ctnnum = pw2.subnum
        and pw2.wrktyp = 'K'
      where iv.stoloc in ('STGSHIP-FDX', 'STGSHIP-CPC', 'STGSHIP-TFORCE', 'STGSHIP-ATLAS', 'PNDSHIP-01')
        and iv.subucc is null] catch(@?) >> res
    |
    if (@? = 0)
    {
        expand environment variable
         where name = '$dc01outputs' || '\Aged Packed Cartons\'
        |
        publish data
         where path = @value
        |
        write csv file
         where resdata = @res
           and filnam = 'NOSUBUCC_' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
           and path = @path
    }
};","$LESDIR/log/usr_invpakstg.log","","0","0 0 7 ? * 2-6","60","","usr_data"
"USR_INV_PRTNUM","","Aritzia Inventory by Item Report","0","cron","[select iv.prtnum,
        iv.invsts,
        sum(iv.untqty) untqty
   from inventory_view iv
  inner
   join locmst loc
     on iv.stoloc = loc.stoloc
  inner
   join loc_typ lt
     on loc.loc_typ_id = lt.loc_typ_id
  where iv.ship_line_id is null
    and loc.useflg = 1
    and lt.fwiflg = 1
    and loc.wh_id = nvl(@wh_id, 'DC01')
  group by iv.prtnum,
        iv.invsts
  order by iv.prtnum,
        iv.invsts] >> res
|
expand environment variable
 where name = '$dc01outputs' || '\Inventory Snapshot\'
|
publish data
 where path = @value
|
write csv file
 where resdata = @res
   and filnam = 'inv_prtnum-' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
   and path = @path","$LESDIR/log/usr_inv_prtnum.log","","0","0 30 4 * * ?","60","","usr_data"
"USR_INV_SUPPLIES","","Aritzia Non Merch Inventory","0","cron","[select iv.prtnum,
        iv.invsts,
        loc.arecod,
        reverse(parsename(reverse(replace(pd.lngdsc, ', ', '.')), 2)) description,
        reverse(parsename(reverse(replace(pd.lngdsc, ', ', '.')), 3)) creative,
        reverse(parsename(reverse(replace(pd.lngdsc, ', ', '.')), 4)) creative_2,
        count(distinct iv.stoloc) locations,
        count(distinct iv.subnum) cases,
        sum(iv.untqty) quantity
   from inventory_view iv
  inner
   join locmst loc
     on iv.stoloc = loc.stoloc
    and iv.wh_id = loc.wh_id
  inner
   join prtmst_view pm
     on iv.prtnum = pm.prtnum
    and iv.prt_client_id = pm.prt_client_id
    and iv.wh_id = pm.wh_id
	  inner
   join dss_prtmst dpm
     on iv.prtnum = dpm.prtnum
    and iv.prt_client_id = dpm.prt_client_id
    and iv.wh_id = dpm.wh_id
  inner
   join prtdsc pd
     on pd.colnam = 'prtnum|prt_client_id|wh_id_tmpl'
    and pd.colval = nvl(pm.prtnum, rtrim(' ')) || '|' || nvl(pm.prt_client_id, rtrim(' ')) || '|' || nvl(pm.wh_id, rtrim(' '))
  where pm.typcod = 'ZSUP'
    and loc.arecod not in ('CADJ', 'ADJS')
  group by iv.prtnum,
        loc.arecod,
        pd.lngdsc,
        iv.invsts] catch(@?) >> res
|
if (@? = 0)
{
    expand environment variable
     where name = '$dc01outputs' || '\Inventory Snapshot\'
    |
    publish data
     where path = @value
    |
    write csv file
     where resdata = @res
       and filnam = 'inv_supplies-' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
       and path = @path
}","$LESDIR/log/usr_inv_prtnum.log","","0","0 0 9 * * ?","60","","usr_data"
"USR_INV_VELOCITY","","Aritzia Velocity Report","0","cron","[select format(dateadd(month, datediff(month, 0, sysdate) -1, 0), 'MM-dd-yyyy') dte1,
        format(dateadd(month, datediff(month, 0, sysdate), 0), 'MM-dd-yyyy') dte2
   from dual]
|
[select prtnum,
        sum(pw.appqty) total_pick,
        count(pw.appqty) total_line
   from pckwrk_view pw
  inner
   join ord o
     on pw.ordnum = o.ordnum
    and pw.wh_id = o.wh_id
    and pw.client_id = o.client_id
  where pw.pckdte >= @dte1
    and pw.pckdte < @dte2
    and (pw.wrktyp = 'P' or pw.wrktyp = 'B')
    and o.ordtyp not in ('A01', 'A02', 'APH', 'MR', 'DCT', 'NFT')
  group by prtnum
  order by 1] >> res
|
expand environment variable
 where name = '$dc01outputs' || '\Velocity Report\'
|
publish data
 where path = @value
|
write csv file
 where resdata = @res
   and filnam = 'inv_velocity-' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
   and path = @path","$LESDIR/log/usr_inv_velocity.log","","0","0 0 1 1 * ?","60","","usr_data"
"USR_INV_VIEW_TEMP","","Aritzia Inventory View Snapshot for Boyne Move","0","cron","[select ceil(convert(decimal, count(*)) / 100000) cnt
   from inventory_view]
|
do loop
 where count = @cnt
|
{
    publish data
     where offset = @i * 100000
    |
    [/*#limit=@offset,@limit,true*/
     select *
       from inventory_view
      order by wh_id,
            stoloc,
            lodnum,
            subnum,
            dtlnum] >> res
    |
    expand environment variable
     where name = '$dc01outputs' || '\Detailed Inventory\'
    |
    publish data
     where path = @value
    |
    write csv file
     where resdata = @res
       and filnam = 'inventory_view_part' || to_char(@i + 1) || '_' || to_char(sysdate, 'YYYYMMDDHH24MISS') || '.csv'
       and path = @path
}","$LESDIR/log/usr_inv_view.log","","0","0 0 4 * * ?","60","","usr_data"
"USR_MPS_ALERT","","Aritzia US MPS Alert","0","cron","[select case when to_char(sysdate, 'd') between 2
         and 6 then 'WD'
             else 'WE'
        end dayofweek,
        to_char(sysdate, 'hh24mi') time,
        sysdate init
   from dual]
|
[select 'x' runchk
   from poldat_view
  where polcod = 'DSS-ARITZIA'
    and polvar = 'JOB-MASTER'
    and polval = 'MPS-ALERT'
    and wh_id = nvl(@wh_id, 'DC01')
    and rtstr1 = @dayofweek
    and rtstr2 = @time] catch(-1403)
|
if (@runchk)
{
    expand environment variable
     where name = '$dc01outputs' || '\MPS Alert\'
    |
    publish data
     where path = @value
    |
    [select *
       from (select o.ordnum,
                    o.ordtyp,
                    a.adrnam,
                    s.srvlvl,
                    to_char(s.early_shpdte, 'MM-DD-YYYY') early_shpdte,
                    count(distinct pw.subnum) ctncnt,
                    count(distinct m.traknm) manfstcnt,
                    count(distinct m2.traknm) MPSlblcnt
               from pckwrk_view pw
              inner
               join ord o
                 on o.ordnum = pw.ordnum
                and o.wh_id = pw.wh_id
                and o.client_id = pw.client_id
              inner
               join adrmst a
                 on o.st_adr_id = a.adr_id
              inner
               join shipment s
                 on pw.ship_id = s.ship_id
              inner
               join (select rtstr1,
                            rtstr2,
                            wh_id
                       from poldat_view po
                      where po.polcod = 'DSS-ARITZIA'
                        and po.polval = 'MPS-GUARDRAIL') pv
                 on s.carcod = pv.rtstr1
                and s.srvlvl = pv.rtstr2
                and s.wh_id = pv.wh_id
               left outer
               join manfst m
                 on o.ordnum = m.ordnum
                and m.srvlvl <> 'RETURN'
               left outer
               join manfst m2
                 on o.ordnum = m2.ordnum
                and m2.srvlvl <> 'RETURN'
                and m2.mancls like 'MPS%'
              where pw.wrktyp = 'K'
                and o.ordtyp in ('E05', 'E07', 'E09', 'E11', 'G05', 'G07', 'R05', 'R07', 'S05', 'S07', 'S09', 'S11', 'P05', 'P07', 'I05', 'I07', 'M05', 'M07', 'H05', 'H07', 'J05', 'J07', 'K05', 'K07', 'L05', 'L07')
                and s.early_shpdte >= dateadd(day, datediff(day, 0, sysdate), 0)
              group by o.ordnum,
                    to_char(s.early_shpdte, 'MM-DD-YYYY'),
                    s.srvlvl,
                    o.ordtyp,
                    a.adrnam
             having count(pw.subnum) > 1) usr
      where (manfstcnt = 0 or manfstcnt <> mpslblcnt)
      order by srvlvl,
            ordnum] catch(-1403) >> res
    |
    if (@? = 0)
    {
        write csv file
         where resdata = @res
           and filnam = 'MPS_alert_' || to_char(sysdate, 'YYYYMMDD-HH24MI') || '.csv'
           and path = @path
    };
    expand environment variable
     where name = '$dc01outputs' || '\MPS Alert\MPS_alert_' || to_char(sysdate, 'YYYYMMDD-HH24MI') || '.csv'
    |
    publish data
     where resfil = @value
    |
    find file
     where pathname = @resfil catch(@?)
    |
    if (@pathname = @resfil and @type = 'F')
    {
        expand environment variable
         where name = '$dc01outputs'
        |
        [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                     when charindex('TST', @value) > 0 then 'BY QA'
                     else 'BY PROD'
                end envdsc
           from dual]
        |
        publish data
         where hostname = 'azeus2smtp.jdadelivers.com'
           and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
           and send_to_list = 'supplychaintechteam@aritzia.com;mdixon@aritzia.com;OutboundOrders@aritzia.com;shipping@aritzia.com;chkim@aritzia.com;tmomen@aritzia.com;ege@aritzia.com;rorbeta@aritzia.com'
        |
        send email
         where subject = 'S321 MPS ALERT - ' || @envdsc
           and hostname = @hostname
           and mail_from = @mail_from
           and send_to = @send_to_list
           and message = 'The following US orders have multiple cartons packed being shipped today. Please see attached and triage.'
           and attachment = @resfil
    }
}","$LESDIR/log/usr_mps_guardrail.log","","0","5 0/5 8-23 ? * * *","60","","usr_data"
"USR_OPN_IS_ALERT","","Aritzia Open Inbound Shipment Alert","0","cron","[select trknum,
        expclose
   from (select trknum,
                trkdte,
                case when substr(trknum, instr(trknum, 'RTNS') + 10, 2) = 'PM' then trkdte + 1
                     else trkdte + (24 / (24 * 1.0))
                end expclose
           from (select trknum,
                        convert(datetime, substr(trkdte, 5, 2) + substr(trkdte, 1, 2) + substr(trkdte, 3, 2), 101) trkdte
                   from (select trknum,
                                substr(trknum, instr(trknum, 'RTNS') + 4, 6) trkdte
                           from RCVTRK
                          where rcvtrk_stat = 'R'
                            and trknum like '%RTN%') usr) usr) usr
  where sysdate > expclose
  order by expclose,
        trknum] catch(-1403) >> res
|
if (@? = 0)
{
    convert column results to string
     where resultset = @res
       and colnam = 'trknum'
       and separator = '
	   '
    |    
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'hsato@aritzia.com;rcalzo@aritzia.com;ege@aritzia.com;eComInOrderExpeditor@aritzia.com;supplychaintechteam@aritzia.com'
       and trknum = @result_string
    |
	expand environment variable
     where name = '$dc01outputs'
    |
    [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                 when charindex('TST', @value) > 0 then 'BY QA'
                 else 'BY PROD'
            end envdsc
       from dual]
    |
    send email
     where subject = 'Inbound Shipments Still Open - ' || @envdsc
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'The following Inbound Shipments are still open: 
	   ' || @trknum catch(@?)
}
else if (@? <> -1403)
{
    [select trknum
       from RCVTRK
      where rcvtrk_stat = 'R'
        and trknum like '%RTN%'] catch(-1403) >> res
    |
    if (@? = 0)
    {
        convert column results to string
         where resultset = @res
           and colnam = 'trknum'
           and separator = ', '
        |
        publish data
         where hostname = 'azeus2smtp.jdadelivers.com'
           and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
           and send_to_list = 'hsato@aritzia.com;rcalzo@aritzia.com;enieh@aritzia.com;ege@aritzia.com;eComInOrderExpeditor@aritzia.com;supplychaintechteam@aritzia.com'
           and trknum = @result_string
        |
        expand environment variable
         where name = '$dc01outputs'
        |
        [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                     when charindex('TST', @value) > 0 then 'BY QA'
                     else 'BY PROD'
                end envdsc
           from dual]
        |
        send email
         where subject = 'Inbound Shipments Still Open - ' || !@envdsc
           and hostname = @hostname
           and mail_from = @mail_from
           and send_to = @send_to_list
           and message = 'The following Inbound Shipments are still open: ' || @trknum catch(@?)
    }
}","$LESDIR/log/usr_opn_is_alert.log","","0","0 30 14 ? * * *","60","","usr_data"
"USR_ORD_RPT","","Aritzia Order Statistics Reports","0","cron","{
    [select to_char(convert(date, adddte)) || ' ' || format(adddte, 'hh:mm tt') || ' , ' || to_char(avgtime) || ' , ' || to_char(maxtime) || ' , ' || to_char(ordcnt) || CHAR(13) string
       from (select dateadd(hour, datediff(hour, 0, adddte), 0) adddte,
                    round(avg(convert(float, datediff(second, entdte, adddte)) / 60), 3) avgtime,
                    round(max(convert(float, datediff(second, entdte, adddte)) / 60), 3) maxtime,
                    count(*) ordcnt
               from ord
              where adddte > dateadd(day, datediff(day, 0, sysdate), 0)
                and ordtyp not in ('ZSO', 'A01', 'APH', 'A02')
              group by dateadd(hour, datediff(hour, 0, adddte), 0)) usr
      order by adddte desc] catch(@?) >> res
    |
    if (@? = 0)
    {
        convert column results to string
         where colnam = 'string'
           and res = @res
           and separator = '
'
        |
        publish data
         where data = @result_string
           and hostname = 'azeus2smtp.jdadelivers.com'
           and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
           and send_to_list = 'supplychaintechteam@aritzia.com'
		|
		        expand environment variable
         where name = '$dc01outputs'
        |
        [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                     when charindex('TST', @value) > 0 then 'BY QA'
                     else 'BY PROD'
                end envdsc
           from dual]
        |
        send email
         where subject = 'Integrator Order Processing Statistics - ' || @envdsc
           and hostname = @hostname
           and mail_from = @mail_from
           and send_to = @send_to_list
           and message = 'DATE , AVGTIME , MAXTIME , ORDCNT
' || '
' || @data
    }
};
{
    publish data
     where days = 1
    |
    [select to_char(format(dtegrp, 'MM-dd-yyyy hhtt')) || ' , ' || to_char(cancnt) || ' , ' || to_char(usacnt) string
       from (select hr.dtegrp,
                    nvl(canord.cancnt, 0) cancnt,
                    nvl(usaord.usacnt, 0) usacnt
               from (select dateadd(hour, colorder - 1, dateadd(day, datediff(day, 0, sysdate), 0)) dtegrp
                       from (select colorder
                               from syscolumns c1
                              inner
                               join (select top 1 c2.id
                                       from syscolumns c2
                                      group by c2.id
                                     having count(*) >= 24) c3
                                 on c1.id = c3.id
                              where colorder <= 24) hrs) hr
               left outer
               join (select dateadd(hour, datediff(hour, 0, o.adddte), 0) ordhr,
                            count(*) cancnt
                       from ord o
                      inner
                       join (select rtstr1 ordtyp,
                                    rtstr2 ordstr
                               from poldat_view pv
                              where pv.polcod = 'DSS-ARITZIA'
                                and pv.polvar = 'REPORTING'
                                and pv.polval = 'ORDTYP-XREF'
                                and pv.wh_id = nvl(@wh_id, 'DC01')
                                and pv.rtstr2 like '%CAN ECOMM%') ot
                         on o.ordtyp = ot.ordtyp
                      where o.adddte > dateadd(day, datediff(day, 0, sysdate), 0)
                      group by dateadd(hour, datediff(hour, 0, o.adddte), 0)) canord
                 on hr.dtegrp = canord.ordhr
               left outer
               join (select dateadd(hour, datediff(hour, 0, o.adddte), 0) ordhr,
                            count(*) usacnt
                       from ord o
                      inner
                       join (select rtstr1 ordtyp,
                                    rtstr2 ordstr
                               from poldat_view pv
                              where pv.polcod = 'DSS-ARITZIA'
                                and pv.polvar = 'REPORTING'
                                and pv.polval = 'ORDTYP-XREF'
                                and pv.wh_id = nvl(@wh_id, 'DC01')
                                and pv.rtstr2 like '%USA ECOMM%') ot
                         on o.ordtyp = ot.ordtyp
                      where o.adddte > dateadd(day, datediff(day, 0, sysdate), 0)
                      group by dateadd(hour, datediff(hour, 0, o.adddte), 0)) usaord
                 on hr.dtegrp = usaord.ordhr) data
      order by dtegrp] >> res
    |
    if (@? = 0)
    {
        convert column results to string
         where colnam = 'string'
           and res = @res
           and separator = '
'
        |
        
        publish data
         where data = @result_string
           and hostname = 'azeus2smtp.jdadelivers.com'
           and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
           and send_to_list = 'supplychaintechteam@aritzia.com'
        |
		expand environment variable
         where name = '$dc01outputs'
        |
        [select case when charindex('DEV', @value) > 0 then 'BY DEV'
                     when charindex('TST', @value) > 0 then 'BY QA'
                     else 'BY PROD'
                end envdsc
           from dual]
        |
        send email
         where subject = 'Order Drop Statistics - ' || @envdsc
           and hostname = @hostname
           and mail_from = @mail_from
           and send_to = @send_to_list
           and message = 'DATE , CANECOM , USAECOM
' || '
' || @data
    }
};","$LESDIR/log/ord_ord_rpt.log","","0","0 0 6-22 ? * * *","","","usr_data"
"USR_PIC_LOC_LOG","","Aritzia PIC Hourly Location Log","0","cron","[/*#limit=@offset,@limit,true*/
 select loc.arecod area,
        loc.stoloc,
        loc.wrk_zone_id,
        loc.locacc,
        loc.curqvl,
        loc.maxqvl,
        nvl(invlst.article, '-') article,
        nvl(invlst.invsts, '-') invsts,
        nvl(invlst.untqty, 0) untqty,
        nvl(invlst.cascnt, 0) cascnt
   from locmst loc
  inner
   join loc_typ lt
     on loc.loc_typ_id = lt.loc_typ_id
   left outer
   join (select iv.stoloc,
                iv.prtnum article,
                iv.invsts,
                count(distinct iv.subnum) cascnt,
                sum(iv.untqty) untqty
           from inventory_view iv
          inner
           join locmst loc
             on iv.stoloc = loc.stoloc
          inner
           join loc_typ lt
             on loc.loc_typ_id = lt.loc_typ_id
          where iv.ship_line_id is null
            and loc.useflg = 1
            and lt.sigflg = 1
            and loc.wh_id = nvl(@wh_id, 'DC01')
            and iv.invsts not in ('WHS', 'DON', 'QM', 'DES', 'RTV')
          group by iv.prtnum,
                iv.stoloc,
                iv.invsts) invlst
     on invlst.stoloc = loc.stoloc
  inner
   join aremst am
     on loc.arecod = am.arecod
    and loc.wh_id = am.wh_id
  where loc.useflg = 1
    and lt.sigflg = 1
    and loc.wh_id = nvl(@wh_id, 'DC01')
  order by loc.stoloc,
        loc.locacc,
        loc.curqvl,
        loc.maxqvl] >> res
|
expand environment variable
 where name = '$dc01outputs' || '\Physical Inventory\'
|
publish data
 where path = @value
|
write csv file
 where resdata = @res
   and filnam = 'inv_location-' || to_char(sysdate, 'YYYYMMDD-HH24MISS') || '.csv'
   and path = @path","$LESDIR/log/usr_pic_loc.log","","0","0 10 6-23 5,6,7 2 ? 2021","60","","usr_data"
"USR_PRTFAMUPD_TLCHIVOL","","Aritzia Item Family Update TLC-HI_VOL","0","cron","list warehouses
|
[select dss.prtnum,
        prtmst.prtfam old_prtfam
   from dss_prtmst dss
  inner
   join inventory_view inv
     on dss.prtnum = inv.prtnum
    and dss.prt_client_id = inv.prt_client_id
    and dss.wh_id = inv.wh_id
  inner
   join prtmst
     on dss.prtnum = prtmst.prtnum
    and dss.prt_client_id = prtmst.prt_client_id
    and dss.wh_id = prtmst.wh_id_tmpl
        /* Looking for all coats and jackets with WOOL, excluding blazers and shirt jackets */
  where dss.merch_catg in ('COAT', 'JACKET')
    and dss.customs_descr like '%WOOL%'
    and (dss.style_en not like '%BLAZER%' and dss.style_en not like '%SHIRT%')
 /* items where item family is not already TLC-HI_VOL */
    and prtmst.prtfam <> 'TLC-HI_VOL'
    and prtmst.wh_id_tmpl = @wh_id
  group by dss.prtnum,
        prtmst.prtfam] catch(-1403)
|
if (@? = 0)
{
    [update prtmst
        set prtfam = 'TLC-HI_VOL',
            last_upd_dt = sysdate,
            last_upd_user_id = 'NOUSER'
      where prtnum = @prtnum
        and wh_id_tmpl = @wh_id] catch(@?)
    |
    if (@? = 0)
    {
        write output file
         where filnam = 'usr_prtfam_update_TLC.log'
           and data = sysdate || ',' || @prtnum || ',' || @old_prtfam || ',' || 'Item family TLC-HI_VOL update successful'
           and newline = 'Y'
           and mode = 'A'
           and path = '$LESDIR/log'
    }
    else
    {
        write output file
         where filnam = 'usr_prtfam_update_TLC.log'
           and data = sysdate || ',' || @prtnum || ',' || @old_prtfam || ',' || 'Item family TLC-HI_VOL update failure'
           and newline = 'Y'
           and mode = 'A'
           and path = '$LESDIR/log'
    }
}
","$LESDIR/log/usr_prtfamupd_tlchivol.log
","","0","5 5 5-23 ? * * *","","","usr_data"
"USR_PRTFTP_LOG","","Aritzia Footprint Master","0","cron","[select ceil(convert(decimal, count(*)) / 100000) cnt
   from prtftp
  where defftp_flg = 1
    and wh_id = nvl(@wh_id, 'DC01')]
|
do loop
 where count = @cnt
|
{
    publish data
     where offset = @i * 100000
    |
    [/*#limit=@offset,@limit,true*/
     select pf.prtnum,
            ap.alt_prtnum,
            pf.ftpcod,
            pfd2.len,
            pfd2.wid,
            pfd2.hgt,
            decode(instr(pf.ftpcod, 'Q'), 0, pf.ftpcod, decode(instr(pf.ftpcod, 'T'), 0, pf.ftpcod, substr(pf.ftpcod, instr(pf.ftpcod, 'Q', 1) + 1, instr(pf.ftpcod, 'T', 1) - instr(pf.ftpcod, 'Q', 1) -1))) untcas,
            decode(instr(pf.ftpcod, 'T'), 0, pf.ftpcod, decode(instr(pf.ftpcod, 'H'), 0, pf.ftpcod, substr(pf.ftpcod, instr(pf.ftpcod, 'T', 1) + 1, instr(pf.ftpcod, 'H', 1) - instr(pf.ftpcod, 'T', 1) -1))) ti,
            substr(pf.ftpcod, instr(pf.ftpcod, 'H', 1) + 1, length(pf.ftpcod) - instr(pf.ftpcod, 'H', 1)) hi,
            pfd.grswgt / 16 ea_wgt,
            pfd2.grswgt / 16 cs_wgt
       from prtftp pf
      inner
       join alt_prtmst ap
         on pf.prtnum = ap.prtnum
        and ap.alt_prt_typ = 'UPCCOD'
        and pf.prt_client_id = ap.prt_client_id
      inner
       join prtftp_dtl pfd
         on pf.prtnum = pfd.prtnum
        and pf.prt_client_id = pfd.prt_client_id
        and pf.wh_id = pfd.wh_id
        and pf.ftpcod = pfd.ftpcod
        and pfd.uomcod = 'EA'
      inner
       join prtftp_dtl pfd2
         on pf.prtnum = pfd2.prtnum
        and pf.prt_client_id = pfd2.prt_client_id
        and pf.wh_id = pfd2.wh_id
        and pf.ftpcod = pfd2.ftpcod
        and pfd2.uomcod = 'CS'
      where pf.defftp_flg = 1
        and pf.wh_id = nvl(@wh_id, 'DC01')
      order by pf.prtnum] >> res
    |
    expand environment variable
     where name = '$dc01outputs' || '\Footprint Master\'
    |
    publish data
     where path = @value
    |
    write csv file
     where resdata = @res
       and filnam = 'prtftp_mst_' || to_char(@i + 1) || '_' || to_char(sysdate, 'YYYYMMDDHH24MISS') || '.csv'
       and path = @path
}","$LESDIR/log/usr_prtftp_log.log","","0","0 0 3 ? * 1","60","","usr_data"
"USR_RATINGTEST","","Aritzia Temp Parcel Rate Test","0","timer","[select top 1 iv.subnum
   from inventory_pckwrk_view iv
  inner
   join shipment s
     on iv.ship_id = s.ship_id
  where iv.subnum like 'SHP%'
    and s.carcod = 'FDXAIRCAN'
    and s.srvlvl = '3DAIR8P'
    and (iv.stoloc = 'PNDSHIP-01' or iv.stoloc like 'STN%STG')
  group by iv.subnum] catch(-1403)
|
if (@? = 0)
{
    rate pm package
     WHERE weight = 1.6
       AND height = 0.75
       AND length = 14
       AND width = 10
       AND ltlcls = ''
       AND pakval = ''
       AND stname = 'FAKE RATING'
       AND stadd1 = '415 Boyne Street'
       AND stcity = 'New Westminster'
       AND ststcd = 'BC'
       AND stposc = 'V3M5K2'
       AND stphon = '7783312240'
       AND carcod = 'FDXAIRCAN'
       AND srvlvl = '3DAIR8P'
       AND stcnty = 'CAN'
       AND strsaf = 0
       AND wh_id = 'DC01'
       AND dry_ice_wgt = ''
       AND dry_ice_flg = 0
       AND cod_ind_type = 0
       AND pkgcod = ''
       AND paytrm = 'PRD'
       AND carsrv_param_list = null
       AND shpdte = '20210420000000'
       and invtid = @subnum catch(@?)
}","","","0","","60","20",""
"USR_RCVFLG","","Aritzia Receivable & Production Flag","0","cron","[update prtmst
    set rcvflg = 1
  where prtnum in (select distinct prtnum
                     from prtftp
                    where defftp_flg = 1)
    and wh_id_tmpl = nvl(@wh_id, 'DC01')
    and rcvflg = 0] catch(@?);
[update prtmst
    set prdflg = 0
  where prdflg = 1
    and typcod = 'ZSUP'] catch(@?);","$LESDIR/log/usr_rcvflg.log","","0","0 5,35 * * * ?","60","","usr_data"
"USR_S321_DECOUP_NOTE","","Aritzia Decoupled Note Bandaid (Obsolete)","0","cron","/* Note Text Bandaid */
[select distinct olnt.ordnum
   from ord_line_note olnt
   left outer
   join ord_note ont
     on olnt.ordnum = ont.ordnum
    and ont.nottyp = 'PAK_DECOUPLE'
  where olnt.nottyp = 'PAK_DECOUPLE'
    and ont.ordnum is null] catch(@?)
|
if (@? = 0)
{
    [insert
       into ord_note(client_id, ordnum, nottyp, notlin, wh_id, nottxt, edtflg, u_version, ins_dt, last_upd_dt, ins_user_id, last_upd_user_id)
     values ('----', @ordnum, 'PAK_DECOUPLE', '0010', 'DC01', 'REMOVE PRICE FROM STOCK TICKET  DECOUPLED ITEM(S)', '1', '1', sysdate, sysdate, 'USR_SYSJOB', 'USR_SYSJOB')] catch(@?)
    |
    [select ol.ordnum,
            to_char(ol.prtnum || ',' || pcd.prtcolor_dsc || ',' || psd.prtsize_dsc) nottxt,
            lpad(to_number(ol.ordlin) + 100, 4, 0) ordlin
       from ord_line_note oln
      inner
       join ord_line ol
         on oln.ordnum = ol.ordnum
        and oln.ordlin = ol.ordlin
        and oln.ordsln = ol.ordsln
      inner
       join prtdsc pd
         on pd.colnam = 'prtnum|prt_client_id|wh_id_tmpl'
        and pd.colval = ol.prtnum || '|' || ol.prt_client_id || '|' || ol.wh_id
        and pd.locale_id = nvl(@locale_id, @@locale_id)
      inner
       join prtmst pm
         on ol.prtnum = pm.prtnum
        and ol.wh_id = pm.wh_id_tmpl
        and ol.prt_client_id = pm.prt_client_id
      inner
       join (select colval prtcolor,
                    lngdsc prtcolor_dsc
               from dscmst
              where colnam = 'prtcolor'
                and locale_id = 'US_ENGLISH') pcd
         on pm.prtcolor = pcd.prtcolor
      inner
       join (select colval prtsize,
                    lngdsc prtsize_dsc
               from dscmst
              where colnam = 'prtsize'
                and locale_id = 'US_ENGLISH') psd
         on pm.prtsize = psd.prtsize
      where oln.ordnum = @ordnum] catch(@?)
    |
    [insert
       into ord_note(client_id, ordnum, nottyp, notlin, wh_id, nottxt, edtflg, u_version, ins_dt, last_upd_dt, ins_user_id, last_upd_user_id)
     values ('----', @ordnum, 'PAK_DECOUPLE', @ordlin, 'DC01', @nottxt, '1', '1', sysdate, sysdate, 'USR_SYSJOB', 'USR_SYSJOB')] catch(@?)
}","$LESDIR/log/usr_s321_decoup_note.log","","0","0 0/15 4-23 ? * * *","60","","usr_data"
"USR_S321_GUARDRAIL_ALERT","","Aritzia S321 Guardrail Alert","0","cron","expand environment variable
 where name = '$dc01outputs' || '\S321 Alert\'
|
publish data
 where path = @value
|
[select first_name,
        last_name,
        zip,
        ordnum,
        ref_doc,
        adddte,
        shpdte,
        lst_ord,
        diff,
        ordcnt,
        carcod,
        srvlvl,
        schbat,
        nottxt,
        notusr
   from (select TOP 100 PERCENT first_name,
                last_name,
                zip,
                ordnum,
                ref_doc,
                adddte,
                shpdte,
                lst_ord,
                diff,
                ordcnt,
                min(diff) over(partition by first_name || last_name || zip) min_diff,
                carcod,
                srvlvl,
                schbat,
                nottxt,
                notusr
           from (select TOP 100 PERCENT adr.first_name,
                        adr.last_name,
                        substr(adr.adrpsz, 1, 5) zip,
                        o.ordnum,
                        uo.ref_doc,
                        o.adddte,
                        nvl(s.early_shpdte, convert(date, dateadd(hour, 12, o.adddte))) shpdte,
                        convert(date, lag(nvl(s.early_shpdte, dateadd(hour, 12, o.adddte)), 1) over(partition by adr.first_name || adr.last_name || substr(adr.adrpsz, 1, 5)
                                                                                                     order by o.adddte)) lst_ord,
                        datediff(hour, lag(nvl(s.early_shpdte, dateadd(hour, 12, o.adddte)), 1) over(partition by adr.first_name || adr.last_name || substr(adr.adrpsz, 1, 5)
                                                                                                      order by o.adddte), (nvl(s.early_shpdte, dateadd(hour, 12, o.adddte)))) diff,
                        count(*) over(partition by adr.first_name || adr.last_name || substr(adr.adrpsz, 1, 5)) ordcnt,
                        ol.carcod,
                        ol.srvlvl,
                        sl.schbat,
                        orn.nottxt,
                        orn.last_upd_user_id notusr
                   from ord o
                  inner
                   join dss_ord uo
                     on o.ordnum = uo.ordnum
                    and o.client_id = uo.client_id
                    and o.wh_id = uo.wh_id
                  inner
                   join adrmst adr
                     on o.st_adr_id = adr.adr_id
                   left outer
                   join shipment_line sl
                     on o.ordnum = sl.ordnum
                    and sl.ordlin = '0000000001'
                    and sl.linsts <> 'B'
                   left outer
                   join shipment s
                     on sl.ship_id = s.ship_id
                    and s.shpsts <> 'B'
                   left outer
                   join ord_line ol
                     on sl.ordnum = ol.ordnum
                    and sl.ordlin = ol.ordlin
                    and sl.ordsln = ol.ordsln
                   left outer
                   join ord_note orn
                     on o.ordnum = orn.ordnum
                    and o.wh_id = orn.wh_id
                    and o.client_id = orn.client_id
                    and orn.nottyp = 'S321_IT'
                    and orn.notlin = '0001'
                  where o.ordtyp in ('E05', 'E07', 'G05', 'G07', 'R05', 'R07', 'S05', 'S07', 'P05', 'P07', 'I05', 'I07')
                    and o.adddte > sysdate - /*=moca_util.days(*/ 4 /*=)*/
                  order by 10 desc,
                        1,
                        2,
                        3,
                        6) usr
          order by 10 desc,
                1,
                2,
                3,
                6) usr
  where min_diff <= 0
  order by ordcnt desc,
        first_name,
        last_name,
        zip,
        adddte] catch(-1403) >> res
|
if (@? = 0)
{
    write csv file
     where resdata = @res
       and filnam = 'S321_alert_' || to_char(sysdate, 'YYYYMMDD-HH24') || '.csv'
       and path = @path
};
expand environment variable
 where name = '$dc01outputs' || '\S321 Alert\S321_alert_' || to_char(sysdate, 'YYYYMMDD-HH24') || '.csv'
|
publish data
 where resfil = @value
|
find file
 where pathname = @resfil catch(@?)
|
if (@pathname = @resfil and @type = 'F')
{
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'supplychaintechteam@aritzia.com;rlui@aritzia.com;outboundorders@aritzia.com;tmomen@aritzia.com;chkim@aritzia.com;mdixon@aritzia.com;jmac@aritzia.com;alovey@aritzia.com;ssnow@aritzia.com;gsingh@aritzia.com;jeastwood@aritzia.com;dwen@aritzia.com;dlewis@aritzia.com;aabraham@aritzia.com;cchavez@aritzia.com;rlouie@aritzia.com'
    |
    send email
     where subject = 'S321 GUARDRAIL ALERT'
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'Multiple orders identified with the same consignee and ship date. Please see attached.'
       and attachment = @resfil
}","$LESDIR/log/usr_s321_guardrail.log","","0","0 5,35 6-23 ? * 1-7 *","60","","usr_data"
"USR_S321_TIMEREL_ALERT","","Aritzia S321 Time Release Alert","0","cron","[select distinct schbat
   from shipment s
  inner
   join shipment_line sl
     on s.ship_id = sl.ship_id
  inner
   join ord o
     on sl.ordnum = o.ordnum
  where s.early_shpdte is null
    and s.shpsts <> 'B'
    and s.shpsts <> 'R'
    and o.ordtyp in ('E05', 'E07', 'G05', 'G07', 'R05', 'R07', 'S05', 'S07', 'P05', 'P07', 'I05', 'I07')] catch(@?) >> res
|
if (@? = 0)
{
    convert column results to string
     where resultset = @res
       and colnam = 'schbat'
       and separator = ' || '
    |
    publish data
     where hostname = 'azeus2smtp.jdadelivers.com'
       and mail_from = 'ITWMS-DC01Alerts@jdadelivers.com'
       and send_to_list = 'dcsupervisors@aritzia.com;dcteamleaders@aritzia.com;supplychaintechteam@aritzia.com;alovey@aritzia.com;CA_DCitemchecks@aritzia.com'
       and schbat = @result_string
    |
    send email
     where subject = 'US eCommerce Wave(s) Ship Date Not Set'
       and hostname = @hostname
       and mail_from = @mail_from
       and send_to = @send_to_list
       and message = 'US eCommerce Wave(s) Ship Date Not Set
   
Please set the ship date for the following wave(s): ' || ' 

' || @schbat catch(@?)
}","$LESDIR/log/usr_s321_timerel.log","","0","0 0/15 6-23 ? * * *","60","","usr_data"
"USR-ATZ-SUB-MOVE","","Aritzia Case Transfer Job","0","timer","create usr directed work by subload where wh_id = 'DC01'","$LESDIR/log/usr_atz_sub_move.log","","0","","0","30","dcs_data"
"USR_DEFERRED-EXECUTION-INV-RCV","","Aritzia Deferred Execution - Receieve Complete","1","timer","execute deferred commands where comflg = 1 and exec_typ = 'RCV'","$LESDIR/log/DeferredExcecutionRcvComplete.log","","0","","60","60","usr_data"
