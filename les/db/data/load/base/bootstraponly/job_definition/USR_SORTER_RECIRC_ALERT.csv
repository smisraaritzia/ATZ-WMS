job_id,role_id,name,enabled,type,command,log_file,trace_level,overlap,schedule,start_delay,timer,grp_nam
"USR_SORTER_RECIRC_ALERT","","Pack Sorter Recirculation Email Alert",1,"timer","publish data
 where uc_scan_count_threshold = 2
   and uc_recirc_time_window = 30
   and wh_id = 'DC03'
|
publish data
 where uc_recirc_date = sysdate - (@uc_recirc_time_window / 1440)
|
[select carton_id,
        count(*) as uc_scan_count
   from dss_wcs_packsorter_trn
  where scan_time > to_date(@uc_recirc_date)
  group by carton_id
 having count(*) >= @uc_scan_count_threshold] catch(-1403)
|
if (@? = 0)
{
    /*Pull semi colon seperated list of email addresses to send alert to*/
    [select rtstr1 uc_email_list
       from poldat_view
      where polvar = 'PACK-SORTER'
        and polval = 'EMS-EMAIL_LIST'
        and wh_id = @wh_id] catch(-1403)
    |
    if (@? = 0)
    {
        [select rtstr1 as mail_from,
        rtstr2 as hostname
           from poldat_view
          where polcod = 'DSS-ARITZIA'
            and polvar = 'ASN-FOOTPRINT-MATCHING'
            and polval = 'EMS-EMAIL-HEADERINFO'
            and wh_id = @wh_id] catch(-1403)
        |
        if (@? = 0)
        {
            publish data
             where mail_from = @mail_from
               and hostname = @hostname
               and subject = 'DC03 Pack Sorter Carton Recirculation'
               and uc_email_message = 'Multiple recirculations of Carton: ' || @carton_id || ' through Pack Sorter'
            |
            send email
             where message = @uc_email_message
               and send_to = @uc_email_list
               and mail_from = @mail_from
               and subject = @subject
               and hostname = @hostname
        }
    }
};","","",0,"",0,900,""
